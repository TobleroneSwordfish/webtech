<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
  lang="en-GB" xml:lang="en-GB">
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<meta charset="UTF-8"/>
<title>we need a title</title>
</head>
<body>
<ul class="navbar horizontal">
  <li><a href="/">Home</a></li>
  <li><a href="/datapage.html">Data page</a></li>
  <li><a href="/about.html">About</a></li>
</ul>
<h1>hmm yes</h1>
<p>The current time and date is ${time} oh gods the end draws near we are all such brief mortals</p>
<p id="jsondump">
<script>
  "use strict"
  fetch("http://census.daybreakgames.com/s:jtwebtech/get/ps2/character").then(handle);
  function handle(response) {
    //console.log(response);
    response.json().then(fill)
  }
  function fill(data) {
    //console.log(data);
    
    document.body.querySelector("#jsondump").innerHTML = JSON.stringify(data);
  }
</script>

<script>
  var serviceID = "s:jtwebtech"
  let socket = new WebSocket("wss://push.planetside2.com/streaming?environment=ps2&service-id=" + serviceID);
  socket.onmessage = handle;
  socket.onopen = start;
  var msgCount = 0;
  function handle(event) {
    console.log(event.data);
    msgCount++;
    if (msgCount > 100) {
      socket.close();
    }
  }
  function start(e) {
    //subscribe to all death events from world ID 1 (connery server)
    socket.send(JSON.stringify({
	    "service":"event",
      "action":"subscribe",
      "characters":["all"],
      "worlds":["1"],
      "eventNames":["Death"]
    }));
  }
</script>
</body>
</html>